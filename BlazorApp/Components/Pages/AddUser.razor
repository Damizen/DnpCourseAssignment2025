@page "/users/add"
@inject IUserService UserService
@using ApiContracts
@using BlazorApp.Service
@rendermode InteractiveServer
<h3>Add New User</h3>

<EditForm Model="newUser" OnValidSubmit="HandleSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="mb-3">
        <label>Username:</label>
        <InputText @bind-Value="newUser.Username" class="form-control" />
    </div>

    <div class="mb-3">
        <label>Password:</label>
        <InputText @bind-Value="newUser.Password" type="password" class="form-control" />
    </div>

    <button class="btn btn-primary" type="submit">Create User</button>
</EditForm>

@if (!string.IsNullOrEmpty(statusMessage))
{
    <p class="mt-3 text-success">@statusMessage</p>
}

@code {
    private CreateUserDto newUser = new() {Username = string.Empty, Password = string.Empty};
    private string? statusMessage;

    private async Task HandleSubmit()
    {
        try
        {
            var created = await UserService.AddUserAsync(newUser);
            statusMessage = $"User '{created.Username}' created successfully!";
            newUser = new(){Username = string.Empty, Password = string.Empty};
        }
        catch (Exception e)
        {
            statusMessage = $"Error: {e.Message}";
        }
    }
}